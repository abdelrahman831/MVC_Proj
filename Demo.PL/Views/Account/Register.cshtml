@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model RegisterViewModel
@{
    Layout = "_AuthLayout";
}

<div class="card-front">
    <div class="center-wrap">
        <div class="section text-center">
            <h4 class="mb-4 pb-3">Sign Up</h4>
            <form asp-action="Register" id="registerForm">
                <div id="validation-summary" asp-validation-summary="All" class="d-none"></div>

                <div class="form-group mt-2 position-relative">
                    <input class="form-style" type="text" asp-for="FName" placeholder="Enter Your First Name" id="FName">
                    <i class="fas fa-exclamation-circle error-icon"></i>
                    <span asp-validation-for="FName" class="d-none"></span>
                </div>

                <div class="form-group mt-2 position-relative">
                    <input class="form-style" type="text" asp-for="LName" placeholder="Enter Your Last Name" id="LName">
                    <i class="fas fa-exclamation-circle error-icon"></i>
                    <span asp-validation-for="LName" class="d-none"></span>
                </div>

                <div class="form-group mt-2 position-relative">
                    <input class="form-style" type="email" asp-for="Email" placeholder="Enter Your Email" id="Email">
                    <i class="fas fa-exclamation-circle error-icon"></i>
                    <span asp-validation-for="Email" class="d-none"></span>
                </div>

                <div class="form-group mt-2 position-relative">
                    <input class="form-style" type="password" asp-for="Password" placeholder="Enter Your Password" id="Password">
                    <i class="fas fa-exclamation-circle error-icon"></i>
                    <span asp-validation-for="Password" class="d-none"></span>
                </div>

                <div class="form-group mt-2 position-relative">
                    <input class="form-style" type="password" asp-for="ConfirmPassword" placeholder="Confirm Password" id="ConfirmPassword">
                    <i class="fas fa-exclamation-circle error-icon"></i>
                    <span asp-validation-for="ConfirmPassword" class="d-none"></span>
                </div>

                <div class="form-group mt-2">
                    <input type="checkbox" asp-for="IsAgree" id="IsAgree">
                    <label for="IsAgree">I agree to the terms</label>
                </div>

                <button class="btn mt-4" type="submit">Register</button>
            </form>
        </div>
    </div>
</div>

<style>
    .form-style.is-invalid {
        border: 2px solid red;
    }

    .error-icon {
        position: absolute;
        right: 10px;
        top: 50%;
        transform: translateY(-50%);
        color: red;
        display: none; /* Nascosta di default */
    }
</style>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        console.log("Tooltip validation initialized");

        function activateTooltips() {
            document.querySelectorAll(".form-style").forEach(function (input) {
                let validationMessage = document.querySelector(`span[data-valmsg-for="${input.name}"]`);
                let errorIcon = input.nextElementSibling; // L'icona accanto all'input
                let errorText = validationMessage ? validationMessage.innerText.trim() : "";

                if (errorText !== "") {
                    input.classList.add("is-invalid");
                    errorIcon.style.display = "inline"; // Mostra l'icona
                    errorIcon.setAttribute("data-bs-toggle", "tooltip");
                    errorIcon.setAttribute("data-bs-placement", "right");
                    errorIcon.setAttribute("title", errorText);

                    // Inizializza il tooltip solo sull'icona di errore
                    new bootstrap.Tooltip(errorIcon);
                } else {
                    removeError(input);
                }
            });
        }

        function removeError(input) {
            let errorIcon = input.nextElementSibling; // L'icona accanto all'input

            input.classList.remove("is-invalid");
            errorIcon.style.display = "none"; // Nasconde l'icona
            errorIcon.removeAttribute("data-bs-toggle");
            errorIcon.removeAttribute("data-bs-placement");
            errorIcon.removeAttribute("title");

            let tooltipInstance = bootstrap.Tooltip.getInstance(errorIcon);
            if (tooltipInstance) tooltipInstance.dispose();
        }

        // Controlla la validazione in tempo reale
        document.querySelectorAll(".form-style").forEach(function (input) {
            input.addEventListener("keyup", function () {
                $(this).valid(); // Attiva la validazione jQuery

                let validationMessage = document.querySelector(`span[data-valmsg-for="${this.name}"]`);
                setTimeout(() => {
                    let newErrorText = validationMessage ? validationMessage.innerText.trim() : "";
                    if (newErrorText === "") {
                        removeError(this);
                    } else {
                        activateTooltips();
                    }
                }, 100);
            });

            input.addEventListener("change", function () {
                $(this).valid(); // Forza la validazione quando l'input cambia
                activateTooltips();
            });

            input.addEventListener("blur", activateTooltips);
        });

        // Controlla la validazione dopo il submit
        document.getElementById("registerForm").addEventListener("submit", function (event) {
            setTimeout(activateTooltips, 100);
        });
    });
</script>

@section ValidationScripts {
    <partial name="_ValidationScriptsPartial" />
}
